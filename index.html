<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wizardess Winter Saga ‚Äì Chapter III</title>

<style>
html,body{
    margin:0;
    padding:0;
    height:100%;
    background:#f2e9d8;
    font-family:'Times New Roman', serif;
}

body{
    display:flex;
    justify-content:center;
    align-items:center;
    border:45px solid transparent;
    border-image:url("https://images.stockcake.com/public/8/b/2/8b2225ec-71fc-4b29-84a1-fdab699d419e_large/vintage-victorian-frame-stockcake.jpg") 60 round;
    box-sizing:border-box;
}

#frame{
    width:100%;
    max-width:900px;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
}

.page{
    display:none;
    width:100%;
    height:100%;
    justify-content:center;
    align-items:center;
    animation:fade .6s ease;
}

.page.active{ display:flex; }

@keyframes fade{
    from{opacity:0}
    to{opacity:1}
}

.chapter-box{
    background:linear-gradient(#fffaf2,#fff5e6);
    border:2px solid #d4c8b8;
    border-radius:10px;
    padding:36px;
    width:85%;
    max-height:82vh;
    overflow-y:auto;
    box-shadow:inset 0 0 25px rgba(0,0,0,.08),
               0 10px 22px rgba(0,0,0,.15);
    font-size:20px;
    line-height:1.9;
}

.centered-image{
    display:block;
    margin:22px auto;
    max-width:60%;
}

#musicToggle{
    position:fixed;
    top:12px;
    right:12px;
    z-index:1000;
}
</style>
</head>

<body>

<button id="musicToggle">üîä Music</button>

<div id="frame">

<!-- TITLE PAGE -->
<div class="page active">
    <div class="chapter-box" style="text-align:center">
        <img src="sprites2/snowflake.gif" class="centered-image">
        <h1>Wizardess Winter Saga</h1>
        <h2>Chapter III</h2>
    </div>
</div>

<!-- INTRO PAGE -->
<div class="page">
    <div class="chapter-box">
        <img src="sprites2/castle_stairs.png" class="centered-image">
        <p>
            With the Mirah ordeal taken care of, Wizardess descended the last run of spiral stairs of the old castle.
            Her footsteps were hushed yet swift. Upon reaching the bottom, she found the main door of the castle locked,
            but a large window was left unguarded. With little effort, she squeezed herself through the tight space.
            Once outside under the moonlit sky, she crouched against the castle wall and strategized the spells to use.
            After meticulous thought, she peeked from behind a column but could not find Dread. Then, almost suddenly,
            a large flapping sound came from above, mixed with the strange smell of <strong>dragon fire</strong>.
        </p>
        
        <img src="sprites2/dragon_flying.gif" class="centered-image">
        
        <p>
            She ducked down on instinct and looked up. A bright red streak flew across the sky against glistening, yet faded,
            stars. Dread‚Äôs massive wings flapped as he patrolled the castle from above. He must have sensed that something
            was amiss and alas, he noticed the Wizardess crouching behind the column. In an instant, he plunged toward her
            in fiery rage.
        </p>
        
    </div>
</div>

<!-- STORY PAGE -->
<div class="page">
    <div class="chapter-box">
        <p>
            The dragon breathed huge flames and hurled them at the Wizardess. The wand came to her hands swiftly, and she
            summoned a <strong>frost envelope </strong>to protect herself from the fire. Once Dread took a brief pause from his vulgar conduct,
            she seized the opportunity to hurl an ice ball at him, forcing him to back off. They continued fighting in this manner,
            and as time progressed, both Dread and the Wizardess began to grow weary.
        </p>
        
        <img src="sprites2/dragon_hitting.gif" class="centered-image">
        
        <p>
            One of the squirrels, kept for Dread‚Äôs feast along with the Wizardess, stepped onto the castle‚Äôs terrace when the door
            was found unlocked. Curious, she climbed onto the wall and noticed the Wizardess fighting below. Without wasting any
            further time, she called upon the other trapped animals and helped <strong> hoist the old cannon</strong> that had once stood atop the
            terrace wall in earlier times.
        </p>        
    </div>
</div>

<!-- GAME PAGE -->
<div class="page">
    <div class="chapter-box">

        <p style="text-align:center">
            <strong> Aid Wizardess in defeating Dread </strong> <br>
            Rotate the Cannon and Fire <br>
            (You have multiple shots)
        </p>

        <!-- GAME CONTAINER -->
        <div id="game" style="
            position:relative;
            width:100%;
            height:50vh;
            background:linear-gradient(rgb(92, 56, 56),#f78f8f);
            border-bottom:4px solid #555;
            overflow:hidden;
        ">
            <img id="cannon" src="sprites2/cannon.png" style="
                position:absolute;
                left:10px;
                bottom:10px;
                width:50px;
                transform-origin:20% 50%;
                transform:rotate(-45deg);
            ">

            <img id="ball" src="sprites2/cannon_ball.png" style="
                position:absolute;
                width:18px;
                display:none;
            ">

            <img id="dragon" src="sprites2/sitting_dragon.gif" style="
                position:absolute;
                right:10px;
                bottom:10px;
                width:50px;
            ">
        </div>

        <div style="text-align:center;margin-top:10px">
            <button onclick="rotate(-5)">‚ü≥</button>
            <button onclick="rotate(5)">‚ü≤</button>
            <button onclick="fire()">üî• Fire</button>
        </div>

    </div>
</div>

<!-- FINAL PAGE -->
<div class="page">
    <div class="chapter-box" style="text-align:center">
        <img src="sprites2/win_screen.gif" class="centered-image">
        <p>
            Winter breathed once more through the forest.  
            The dragon lay defeated. Wizardess didn‚Äôt linger for long; after a brief
            salute to the little animals atop the castle,
            she levitated and flew back to her chambers in the little hut.
            <br><br>
            <strong>Merry Christmas, dear Reader.</strong><br>
            <em>Thank you for your patience and time ‚ù§Ô∏è.</em>
        </p>        
    </div>
</div>

</div>

<audio id="titleMusic" src="music2/title_page_bg.mp3" loop></audio>
<audio id="introMusic" src="music2/game_page.mp3" loop></audio>
<audio id="dragonFlap" src="music2/dragon_flap.mp3"></audio>
<audio id="roar" src="music2/dragon_roar.mp3"></audio>
<audio id="gameBG" src="music2/dragon_game.mp3" loop></audio>
<audio id="shot" src="music2/cannon_shot.mp3"></audio>
<audio id="win" src="music2/winning_music.mp3"></audio>

<script>
/* ---------- PAGE SYSTEM ---------- */
const pages=[...document.querySelectorAll(".page")];
let page=0;

function showPage(i){
    pages[page].classList.remove("active");
    page=i;
    pages[page].classList.add("active");
    handleAudio();
}

const GAME_PAGE_INDEX = 3; // change to your actual index

document.body.addEventListener("click", e => {
    if (e.target.tagName === "BUTTON") return;
    if (page === GAME_PAGE_INDEX) return; // ‚õî stop auto-navigation

    if (page < pages.length - 1) {
        showPage(page + 1);
    }
});

/* ---------- AUDIO ---------- */
let audioUnlocked = false;
let musicOn=true;
let current=null;

const audio={
    title:titleMusic,
    intro:introMusic,
    flap:dragonFlap,
    roar:roar,
    game:gameBG,
    win:win
};

function play(a){
    if(current){ current.pause(); current.currentTime=0; }
    current=a;
    if(musicOn) a.play().catch(()=>{});
}

function handleAudio(){
    if(page===0) play(audio.title);
    if(page===1){ play(audio.intro); audio.flap.play(); }
    if(page===2){ play(audio.roar); }
    if(page===3){ play(audio.game); audio.game.volume=0.4; }
    if(page===4){ play(audio.win); audio.win.loop=false; }
}

musicToggle.onclick=()=>{
    musicOn=!musicOn;
    musicToggle.textContent=musicOn?"üîá Mute":"üîä Music";
    if(musicOn && current) current.play();
    if(!musicOn && current) current.pause();
};

document.body.addEventListener("pointerdown", () => {
    if (!audioUnlocked) {
        audioUnlocked = true;
        play(audio.title);
    }
}, { once: true });


/* ---------- GAME LOGIC ---------- */
let angle = 45, cooldown = false, over = false;
const g = 9.81, scale = 5;

// choose breakpoint (px)
let v = window.innerWidth >= 768 ? 35 : 25;


function rotate(d){
    if(over) return;
    angle=Math.max(0,Math.min(90,angle+d));
    cannon.style.transform=`rotate(${-angle}deg)`;
}

function fire(){
    if(cooldown||over) return;
    cooldown=true; setTimeout(()=>cooldown=false,1200);
    shot.currentTime=0; shot.play();

    const c=cannon.getBoundingClientRect();
    const gRect=game.getBoundingClientRect();
    const cx=c.left+c.width*0.2;
    const cy=c.top+c.height/2;

    const rad=angle*Math.PI/180;
    const bx=cx+Math.cos(rad)*c.width*0.75-gRect.left;
    const by=cy-Math.sin(rad)*c.width*0.75-gRect.top;

    let t=0;
    ball.style.display="block";

    (function anim(){
        t+=0.05;
        ball.style.left=bx+v*Math.cos(rad)*t*scale+"px";
        ball.style.top=by-(v*Math.sin(rad)*t-.5*g*t*t)*scale+"px";

        if(hit()){
            over=true;
            ball.style.display="none";
            setTimeout(()=>showPage(4),500);
            return;
        }
        requestAnimationFrame(anim);
    })();
}

function hit(){
    const b=ball.getBoundingClientRect();
    const d=dragon.getBoundingClientRect();
    const HIT_PADDING = 20;

    return !(
      b.right  < d.left + HIT_PADDING ||
      b.left   > d.right - HIT_PADDING ||
      b.bottom < d.top + HIT_PADDING ||
      b.top    > d.bottom - HIT_PADDING
);

}
</script>

</body>
</html>
